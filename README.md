# Магазин Лампочек - Микросервисный Проект

Это учебный проект, демонстрирующий создание веб-приложения с использованием микросервисной архитектуры. Приложение представляет собой интернет-магазин лампочек с клиентской частью и панелью администратора.

## Оглавление

- [Технологии](#технологии)
- [Архитектура](#архитектура)
  - [Клиентский Фронтенд](#клиентский-фронтенд)
  - [Админ-Фронтенд](#админ-фронтенд)
  - [Бэкенд Микросервисы](#бэкенд-микросервисы)
    - [Product Service](#product-service)
    - [Order Service](#order-service)
    - [Admin Service (BFF)](#admin-service-bff)
- [Структура Проекта](#структура-проекта)
- [Предварительные требования](#предварительные-требования)
- [Установка и Запуск](#установка-и-запуск)
  - [1. Клонирование репозитория](#1-клонирование-репозитория)
  - [2. Настройка переменных окружения](#2-настройка-переменных-окружения)
  - [3. Подготовка изображений для Product Service (опционально, для тестов)](#3-подготовка-изображений-для-product-service-опционально-для-тестов)
  - [4. Запуск с помощью Docker Compose](#4-запуск-с-помощью-docker-compose)
- [Доступ к приложению](#доступ-к-приложению)
  - [Клиентский магазин](#клиентский-магазин)
  - [Панель Администратора](#панель-администратора)
- [API Документация (Swagger UI)](#api-документация-swagger-ui)

## Технологии

**Бэкенд:**
- Python 3.11+
- FastAPI: для создания API
- SQLAlchemy: ORM для взаимодействия с базами данных
- Pydantic: для валидации данных
- PostgreSQL: реляционная база данных
- Psycopg2: драйвер PostgreSQL для Python
- Passlib, python-jose: для аутентификации (хэширование паролей, JWT)
- Uvicorn: ASGI сервер
- HTTpx: для межсервисных HTTP-запросов (в Admin Service)

**Фронтенд (Клиентский и Админ-панель):**
- HTML5
- CSS3
- JavaScript (Vanilla JS)

**Инфраструктура и Инструменты:**
- Docker и Docker Compose: для контейнеризации и оркестрации сервисов
- Postman: для тестирования API (коллекции приложены)

## Архитектура

Проект построен на микросервисной архитектуре, включающей:

### Клиентский Фронтенд
- **Расположение:** Папка `shop_frontend/` (или корневая папка проекта, если HTML-файлы магазина там)
- **Описание:** Пользовательский интерфейс для просмотра каталога товаров, страниц товаров, добавления в корзину, оформления и отслеживания заказов.
- **Взаимодействие:** Напрямую с `Product Service` (для каталога и товаров) и `Order Service` (для оформления заказов и промокодов).

### Админ-Фронтенд
- **Расположение:** Папка `admin_frontend/`
- **Описание:** Пользовательский интерфейс для администраторов магазина. Позволяет управлять товарами и заказами.
- **Взаимодействие:** Только с `Admin Service (BFF)`.

### Бэкенд Микросервисы

#### Product Service
- **Расположение:** Папка `product_service/`
- **Порт (на хосте, по умолчанию):** `8001`
- **База данных:** PostgreSQL (контейнер `lampochka_product_db`, порт на хосте `5433`)
- **Ответственность:** Управление каталогом товаров (лампочек), включая информацию о них, характеристики, цены, остатки и изображения. Предоставляет API для CRUD операций с товарами. Раздает статические файлы изображений.

#### Order Service
- **Расположение:** Папка `order_service/`
- **Порт (на хосте, по умолчанию):** `8002`
- **База данных:** PostgreSQL (контейнер `lampochka_order_db`, порт на хосте `5434`)
- **Ответственность:** Обработка заказов клиентов, управление статусами заказов, применение промокодов. Предоставляет API для создания и управления заказами, а также для CRUD операций с промокодами.

#### Admin Service (BFF)
- **Расположение:** Папка `admin_service/`
- **Порт (на хосте, по умолчанию):** `8000`
- **База данных:** PostgreSQL (контейнер `lampochka_admin_db`, порт на хосте `5435`)
- **Ответственность:** Backend For Frontend для админ-панели.
    - Аутентификация администраторов (выдача JWT токенов).
    - Авторизация запросов от админ-панели.
    - Проксирование запросов к `Product Service` и `Order Service` от имени аутентифицированного администратора.

## Структура Проекта

```Markdown
lampochka_factory_backend/
├── admin_frontend/ # Статические файлы фронтенда админ-панели
├── admin_service/ # Код микросервиса Admin Service (BFF)
├── shop_frontend/ # Статические файлы клиентского фронтенда магазина (если выделено)
├── order_service/ # Код микросервиса Order Service
├── product_service/ # Код микросервиса Product Service
│ └── app/
│ └── static/
│ └── product_images/ # Сюда помещать изображения товаров для Product Service
├── db_init_scripts/ # SQL скрипты для инициализации баз данных
│ ├── admin_service/
│ ├── order_service/
│ └── product_service/
├── docker-compose.yml # Файл конфигурации Docker Compose
└── .env.example # Пример файла с переменными окружения (скопировать в .env)
```

## Предварительные требования

- Docker
- Docker Compose

## Установка и Запуск

### 1. Клонирование репозитория
```bash
git clone <URL_вашего_репозитория>
cd lampochka_factory_backend
```
### 2. Настройка переменных окружения
Скопируйте файл .env.example (если вы его создадите) в .env и заполните необходимые значения, особенно пароли для баз данных и JWT_SECRET_KEY.
```bash
cp .env.example .env
```
#### Отредактируйте .env Пример содержимого:
```dotenv
Пример содержимого .env:
### Product Service DB
PRODUCT_DB_USER=prod_user
PRODUCT_DB_PASSWORD=your_strong_prod_password
PRODUCT_DB_NAME=product_service_db
PRODUCT_DB_PORT=5433
PRODUCT_SERVICE_PORT=8001

# Order Service DB
ORDER_DB_USER=order_user
ORDER_DB_PASSWORD=your_strong_order_password
ORDER_DB_NAME=order_service_db
ORDER_DB_PORT=5434
ORDER_SERVICE_PORT=8002

# Admin Service DB
ADMIN_DB_USER=admin_user
ADMIN_DB_PASSWORD=your_strong_admin_password_db
ADMIN_DB_NAME=admin_service_db
ADMIN_DB_PORT=5435
ADMIN_SERVICE_PORT=8000 # Основной порт для доступа к админке

# JWT
JWT_SECRET_KEY=a_very_very_secret_key_that_should_be_long_and_random_1234567890
DEFAULT_ADMIN_PASSWORD=adminpassword # Пароль для первого админа (пользователь "admin")
```
### 3. Подготовка изображений для Product Service (опционально, для тестов)
Поместите файлы изображений товаров (например, 1.jpg, 2.jpg, ..., 20.jpg) в директорию:
product_service/app/static/product_images/
SQL-скрипт db_init_scripts/product_service/03_seed_product_data.sql ссылается на эти файлы.
### 4. Запуск с помощью Docker Compose
Из корневой директории проекта выполните:
```bash
docker-compose up --build -d
```
Эта команда соберет Docker-образы для всех сервисов (если они изменились или их нет) и запустит все контейнеры в фоновом режиме.
Базы данных будут инициализированы SQL-скриптами из db_init_scripts/ при первом запуске (если volumes для БД пусты).
Чтобы остановить все сервисы:
```
docker-compose down
```
Чтобы остановить и удалить volumes (например, для полной переинициализации БД):
```
docker-compose down -v
```
## Доступ к приложению
### Клиентский магазин
Откройте в браузере HTML-файлы из папки клиентского фронтенда (например, shop_frontend/index.html или index.html, если он в корне).
Каталог: index.html
Страница товара (пример): product.html?id=<product_uuid>
Корзина: cart.html
>Примечание: Для корректной работы AJAX-запросов с file:/// протокола может потребоваться запуск локального веб-сервера для папки клиентского фронтенда или использование браузера, разрешающего такие запросы (не рекомендуется). Лучше всего использовать Live Server в VS Code или простой Python HTTP сервер (python -m http.server) из папки фронтенда.

Панель Администратора
Страница входа: Откройте в браузере admin_frontend/login.html (или если она раздается через веб-сервер, то соответствующий URL, например http://localhost:ADMIN_FRONTEND_PORT/login.html).
Доступ к API админки (через Admin Service): http://localhost:8000 (или порт, указанный в ADMIN_SERVICE_PORT).
Учетные данные по умолчанию:
>Логин: admin
>Пароль: adminpassword (или тот, что указан в .env для DEFAULT_ADMIN_PASSWORD)

API Документация (Swagger UI)
После запуска сервисов, документация API (Swagger UI) будет доступна по следующим адресам:
```
Product Service: http://localhost:8001/docs
Order Service: http://localhost:8002/docs
Admin Service: http://localhost:8000/docs
```
